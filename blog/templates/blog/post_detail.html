{% extends 'profiles/base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block header %}

<!-- Page Header -->
<header class="masthead" style="background-image: url({% static 'profiles/images/post-bg.jpg' %})"
        xmlns="http://www.w3.org/1999/html">
    <div class="overlay"></div>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-md-10 mx-auto">
                <div class="post-heading">
                    <h1>{{post.title}}</h1>
                    <!--<h2 class="subheading"> {{ post.text|safe|truncatechars:60}}</h2>-->
                    <span class="meta">Posted by
              <a href="#">{{post.author.get_username}}</a>
              on {{post.published_at}}</span>
                </div>
            </div>
        </div>
    </div>
</header>
{% endblock header %}
{% block content %}
<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-9 col-md-11 mx-auto">
                <h1>{{post.title}}</h1>
                {% if post.published_at %}

                Published at: {{ post.published_at }}

                {% else %}
                {% if user.is_authenticated %}
                <a  href="{% url 'blog:post_publish' post.pk %}">
                    <span class="fa-stack fa-lg">
                        <i class="fas fa-circle fa-stack-2x"></i>
                        <i class="fa fa-upload fa-stack-1x fa-inverse" aria-hidden="true"></i>
                    </span>
                    Publish
                </a>
                {% endif %}
                {% endif %}
                {% if user.is_authenticated %}
                <a href="{% url 'blog:post_update' pk=post.pk   %}">
                    <span class="fa-stack fa-lg">
                        <i class="fas fa-circle fa-stack-2x"></i>
                        <i class="fa fa-edit fa-stack-1x fa-inverse" aria-hidden="true"></i>
                    </span>
                    Edit
                </a>
                <a href="{% url 'blog:post_delete' pk=post.pk %}">
                    <span class="fa-stack fa-lg">
                        <i class="fas fa-circle fa-stack-2x text-danger"></i>
                        <i class="fa fa-trash fa-stack-1x fa-inverse" aria-hidden="true"></i>
                    </span>
                    Delete
                </a>
                <br>
                {% endif %}

                    {{ post.text|safe}}


            </div>
        </div>
    </div>
</article>
<hr>
 {% if post.published_at %}
<div class="container">
    <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
            <!--<a class="btn btn-secondary" href="{% url 'blog:post-comment' pk=post.pk %}">Add comment</a>-->
            <h3>Leave a comment:</h3>
            <form action="{% url 'blog:post-comment' pk=post.pk %}" method="post">
                {% csrf_token %}
                {{form|crispy}}
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
            <h3>Comments:</h3>
            {% for comment in post.comments.all %}
            {% if user.is_authenticated or comment.approved_comment %}
            <div class="comment">
                <div class="date">
                    <strong>{{ comment.author }}</strong> {{ comment.created_at }}
                    {% if not comment.approved_comment %}
                    <a class="btn btn-default" href="{% url 'blog:comment_remove' pk=comment.pk %}">
                        <span class="fa-stack fa-lg">
                            <i class="fas fa-circle fa-stack-2x text-danger"></i>
                            <i class="fa fa-times fa-stack-1x fa-inverse " aria-hidden="true"></i>
                         </span>
                    </a>
                    <a class="btn btn-default" href="{% url 'blog:comment_approve' pk=comment.pk %}">
                         <span class="fa-stack fa-lg">
                            <i class="fas fa-circle fa-stack-2x "></i>
                            <i class="fa fa-check fa-stack-1x fa-inverse " aria-hidden="true"></i>
                         </span>

                    </a>
                    {% endif %}
                </div>

                <p>{{ comment.text|safe|linebreaks}}</p>
            </div>
            {% else %}
              <p>No comments approved yet or this post :(</p>
            {% endif %}
            {% empty %}
            <p>No comments here yet :(</p>
            {% endfor %}
        </div>
    </div>
</div>
   {% endif %}

<!--<div class="post">-->
<!--{% if post.published_at %}-->
<!--<div class="date">-->
<!--Published at: {{ post.published_at }}-->
<!--</div>-->
<!--{% else %}-->
<!--{% if user.is_authenticated %}-->
<!--<a class="btn btn-default" href="{% url 'blog:post_publish' pk=post.pk %}">Publish</a>-->
<!--{% endif %}-->
<!--{% endif %}-->
<!--{% if user.is_authenticated %}-->
<!--<a class="btn btn-default" href="{% url 'blog:post_update' pk=post.pk %}"><span-->
<!--class="glyphicon glyphicon-edit"></span></a>-->
<!--<a class="btn btn-default" href="{% url 'blog:post_delete' pk=post.pk %}"><span-->
<!--class="glyphicon glyphicon-remove"></span></a>-->
<!--{% endif %}-->
<!--<h2>{{ post.title }}</h2>-->
<!--<p>{{ post.text|linebreaksbr }}</p>-->
<!--</div>-->
<!--<hr>-->

{% endblock content%}
{% block js %}
<script type="text/javascript">
    tinymce.init({
        height: 360,
        width: 600,
        theme: 'modern',

        custom_undo_redo_levels: 20,
        selector: 'textarea',
        plugins:'code image imagetools textcolor save link image media preview codesample contextmenu table code lists fullscreen  insertdatetime  nonbreaking directionality searchreplace wordcount visualblocks visualchars code fullscreen autolink lists  charmap print hr anchor pagebreak',
        toolbar1: 'fullscreen preview bold italic underline | fontselect,fontsizeselect  | forecolor backcolor | alignleft alignright |aligncenter alignjustify | indent outdent | bullist numlist table | link image media | codesample |',
        toolbar2:'visualblocks visualchars |charmap hr pagebreak nonbreaking anchor |  code |',
        codesample_languages: [
		{text: 'HTML/XML', value: 'markup'},
		{text: 'JavaScript', value: 'javascript'},
		{text: 'CSS', value: 'css'},
		{text: 'PHP', value: 'php'},
		{text: 'Ruby', value: 'ruby'},
		{text: 'Python', value: 'python'},
		{text: 'Java', value: 'java'},
		{text: 'C', value: 'c'},
		{text: 'C#', value: 'csharp'},
		{text: 'C++', value: 'cpp'}
	],
	 force_br_newlines : true,
  force_p_newlines : false,
  forced_root_block : '' // Needed for 3.x,
        contextmenu: 'formats | link image',

        setup: function (editor) {
            editor.on('change', function (e) {
                editor.save();
            });
        }
    });
</script>
{% endblock js %}